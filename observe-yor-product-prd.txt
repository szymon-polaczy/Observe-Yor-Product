# Observe-Yor-Product (OYP) — 3D Viewer for WooCommerce

## 1. Summary
Observe-Yor-Product (OYP) is a WordPress/WooCommerce plugin that adds a high‑quality, configurable 3D model viewer to product pages with full integration into the default WooCommerce gallery/slider. Store admins can upload 3D models per product/variation, configure background/lighting/controls, and let shoppers interact by click‑and‑drag (desktop) or touch (mobile). The viewer loads assets lazily, only when visible, and scripts/styles are conditionally enqueued. Security features (optional encryption/obfuscation and hotlink protection) reduce the risk of raw model extraction. The viewer includes annotations, autorotation, camera presets, zoom/spin constraints, dynamic scale ruler, and a persistent reset view. A visible badge indicates the media is interactive 3D, with hover‑to‑learn micro‑help.

## 2. Goals & Non‑Goals
### Goals
- Seamless, zero‑code integration with WooCommerce product gallery and variations
- Admin UI to upload 3D files and configure per‑product/per‑variation settings
- Support for common 3D formats and progressive enhancement
- Rich viewer controls: zoom/spin constraints, autorotate, camera presets, reset, annotations
- Visual customization: gradient/background color, lights (direction, intensity, color, multiple sources)
- Dynamic scale ruler with real‑world units (cm/mm etc.) driven by model dimensions
- Lazy loading that looks intentional (skeleton/placeholder), not broken
- Optional asset protection (encryption/obfuscation + best‑effort anti‑exfiltration)
- Performance: load only required assets; GPU‑friendly defaults; responsive sizing

### Non‑Goals (v1)
- Bulletproof DRM (cannot be guaranteed on the web)
- Professional DCC editing (materials/UV baking, mesh editing)
- Server‑side model conversion farm; rely on client‑side + selective preprocessing

## 3. Target Users
- WooCommerce merchants wanting interactive product visualization
- Shoppers evaluating products that benefit from 3D inspection

## 4. Supported Platforms & Compatibility
- WordPress 6.3+; PHP 8.1+ (target 8.3 compatibility)
- WooCommerce 8.x+
- Frontend: evergreen browsers with WebGL2/WebGPU fallback path (progressive: WebGL first)
- Mobile: iOS Safari 16+, Android Chrome 110+

## 5. 3D Formats & Pipelines
- Native: glTF/GLB (PBR, animations), USDZ (for iOS AR handoff if feasible later), OBJ, STL, FBX (imported via converter), DRACO/meshopt compressed glTF
- Strategy: prefer GLB at runtime; auto‑convert/import non‑GLB formats to GLB where possible (server‑side optional or build‑time tool/CLI)
- Textures: KTX2/WEBP with fallbacks; environment maps as HDR/EXR baked to prefiltered

## 6. Core Features
### 6.1 WooCommerce Gallery Integration
- New media type “3D Model” appears as a slide in the default WooCommerce product gallery
- “Next slide”/pagination and thumbnail navigation work as with images/videos
- Click‑and‑drag/touch‑drag to orbit/pan/zoom (when enabled), matching existing UX expectations
- Badge “3D” overlays the slide; hover (desktop) / long‑press (mobile) shows a small help popup with usage tips

### 6.2 Controls & Constraints
- Zoom: enable/disable per product; min/max distances to prevent losing the model
- Orbit: enable/disable axes independently (horizontal only, horizontal+vertical, etc.)
- Pan: optional enable; bounds clamped
- Reset View: button always present to restore default camera and control limits
- Camera Presets: set default camera pose per product/variation; optional list of named presets

### 6.3 Appearance
- Background: solid color or gradient (two colors, angle); optional HDR environment
- Lights: configure 1..N directional/point lights; per‑light color, intensity, direction; presets (e.g., Three‑Point, Studio)
- Materials: no editing in v1 beyond environment and exposure; ensure PBR fidelity with tonemapping

### 6.4 Dynamic Scale Ruler
- Display dynamic ruler that adjusts units based on zoom level: 10 cm → 1 cm → 1 mm, etc.
- Merchant inputs real‑world model dimensions (width/height/depth or single longest edge)
- Plugin maps camera distance/FOV to on‑screen scale; updates continuously while zooming/panning

### 6.5 Annotations
- Interactive hotspots anchored to model space (node/position)
- Admin UI to add/edit annotations (title, description, media, link)
- Frontend: on click, show tooltip/panel; optionally focus camera on annotation
- Future: “slide” system that syncs camera pose with selected annotation

### 6.6 Autoplay/Autorotation
- Optional autorotate on load or after idle timeout
- Configurable speed, axis/axes, easing pattern; pause on user interaction, resume after delay

### 6.7 Lazy Loading & Placeholders
- IntersectionObserver triggers viewer initialization when slide is near/in viewport
- Shows branded skeleton/thumbnail; fades into loaded 3D scene without flashing errors
- Preload low‑res/environment first; progressive texture loading when supported

### 6.8 Variations Support
- Per variation 3D model and settings (e.g., different colors/accessories)
- Seamless swap when variation changes; preserve current camera when reasonable, or reset if configured

### 6.9 Security & Asset Protection (Best‑Effort)
- Optional encryption/obfuscation of GLB payloads stored on server (AES‑GCM with expiring URL key delivery)
- Streamed chunk decryption in worker; never write raw file to disk; disable cache headers
- Watermark/bake subtle identifier; domain hotlink checks; referrer checks; signed URLs
- Educate merchants: cannot guarantee unextractability on the web

### 6.10 Performance & Loading Only When Needed
- Conditional enqueue of scripts/styles only on product pages with 3D content
- Code‑split viewer; ship minimal runtime; tree‑shake
- Use Web Workers for parsing and decryption; off‑main‑thread decoding (KTX2, Draco)

## 7. Admin UX
- Product Edit Screen: new “3D Viewer” panel
  - Upload model(s), choose primary per variation
  - Controls: enable zoom, axis constraints, pan, min/max distances
  - Appearance: background solid/gradient, environment, lights (list with color/intensity/direction)
  - Annotations: add/manage; target node or XYZ; choose icon style
  - Dynamic Scale: enter real‑world dimensions + unit
  - Security: toggle encryption; auto‑generate keys; CDN signed URL support
  - Autoplay: on/off, speed, axes, idle resume
  - Camera: set from live preview; save as default; manage additional presets
- Global Settings: defaults for new products, asset conversion preferences, performance toggles

## 8. Frontend UX
- Integrated as a slide within the Woo gallery with next/prev controls
- 3D badge with hover/long‑press helper
- Reset button always visible inside viewer chrome
- Tooltip micro‑copy for controls and annotations

## 9. Technical Architecture
- Three.js or Model‑Viewer? Decision: Three.js for flexibility; provide adapter for <model-viewer> later
- Rendering: WebGL2; optional WebGPU proof‑of‑concept later
- Module Layout
  - PHP: CPT/meta handling, assets enqueue, variation integration, REST endpoints (signed URLs, settings)
  - JS: viewer core, controls, annotations, scale ruler, loaders, workers (draco, ktx2, decrypt)
  - CSS: scoped BEM classes; minimal theme interference
- Data
  - Stored in post/variation meta (JSON settings); attachment posts for models
  - Encryption keys ephemeral via REST; rotated per request with short TTL

## 10. Accessibility & i18n
- Keyboard shortcuts for reset and focus annotations
- ARIA labels for buttons and badge
- Localizable strings; RTL support

## 11. Telemetry (Optional, opt‑in)
- Anonymous performance stats (load time, GPU tier) to improve defaults

## 12. Error Handling
- Graceful fallback to image if WebGL unsupported
- Friendly inline errors for missing model; avoid console spam in production

## 13. Compliance
- GDPR: no PII; explicit opt‑in for telemetry; data processing agreement note

## 14. Milestones (v1)
1) MVP (viewer + Woo slide + upload + zoom/orbit constraints + reset + lazyload + badge + basic lights + background + dynamic scale ruler + annotations + variation swap + conditional enqueue)
2) Security pass (encryption, signed URLs, cache controls, worker decrypt)
3) Polish (autorotate, camera presets UI, help popovers, performance tuning)

## 15. Future Roadmap
- “Replace default viewer” mode: multi‑annotation scene, slide changes => camera+annotation selection
- AR handoff (USDZ/SceneViewer) where feasible
- Material variants and colorways linked to Woo variations
- WebGPU backend, HDR pipeline improvements, tone mapping controls
- Server‑side conversion helpers for OBJ/FBX to GLB
